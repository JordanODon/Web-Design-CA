<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../CSS/stylesheet.css" />
    <title>Order</title>

    <script> 
        /* This script opens an alert when the supersize option is selected */
        function health(selectedOption) {
            if (selectedOption == "16oz Supersize (€17.50)") {
                alert("Supersizing is very unhealthy, please don't :(")
            }
        };
    </script>
</head>

<body>
    <!-- Logo -->
    <a class="top-middle order-anchor" href="index.html"><img src="../Images/logo.jpg" alt="Order Button" width="250" height="70"></a>
    <!-- Hamburger Menu -->
    <div class="hamburger-menu">
        <input id="menu__toggle" type="checkbox" />

        <label class="menu__btn" for="menu__toggle">
            <span></span>
        </label>
        <!-- Menu Options -->
        <ul class="menu__box">
            <li><a class="menu__item" href="index.html">Homepage</a></li>
            <li><a class="menu__item" href="offers.html">Offers</a></li>
            <li><a class="menu__item" href="order.html">Order</a></li>
        </ul>
    </div>
    
    <!-- This is the form, nested inside is a table, the inputs of the form are assigned to table cells within rows -->
    <form>
        <table class="top-middle" id="top-margin">
            <tr> <!-- Header Row -->
                <th class="wow-font" colspan="2">YOUR ORDER</th>
            </tr>
            <tr> <!-- Username and Password Row -->
                <td> 
                    <label class="wow-font small-font" for="username">Username</label>
                    <input placeholder="Username" size="25" value="Guest" id="username" />
                </td>
                <td>
                    <label class="wow-font small-font" for="password">Password</label>
                    <input type="password" placeholder="Password" size="25" maxlength="9" min="9" id="password" />
                    <span id="password-warning" class="warning-message"></span>
                    <div id="popup-message">Password must be EXACTLY 9 characters long</div>
                </td>
            </tr>
            <tr> <!-- Size and qty Row -->
                <td>
                    <label class="wow-font small-font" for="size">Choose Your Size</label>
                    <select onchange="health(this.value)" id="size">
                        <option selected="selected">--Select an Option--</option>
                        <option id="7">6oz Large (€7)</option>
                        <option id="9">10oz Extra-Large (€9)</option>
                        <option id="17.50">16oz Supersize (€17.50)</option>
                    </select>
                </td>
                <td>
                    <label class="wow-font small-font" for="qty">Burger Qty</label>
                    <input type="number" size="25" min="1" id="qty" value="1">
                </td>
            </tr>
            <tr> <!-- Discount code input row -->
                <td>
                    <label class="wow-font small-font" for="dCode">Discount Code</label>
                    <input type="text" name="" size="25" maxlength="11" id="dCode" />
                </td>
            </tr>
            <tr> <!-- Total Price print row -->
                <td>
                    <div class="wow-font small-font" id="total">Total Price: </div>
                </td>
                <td>
                    <!-- Email the user their order total taken from the form inputs -->
                    <button onclick="getEmail()">Submit</button>
                </td>
            </tr>
        </table>
    </form>

    <script>
        /* These scripts must be at the bottom of the body as the input cannot be accessed until it has been loaded into the DOM */

        /* This script validates that the password length is 9 and gives alerts if its not */
        const passwordInput = document.getElementById("password");
        const passwordWarning = document.getElementById("password-warning");
        const popupMessage = document.getElementById("popup-message");

        let timerId;

        function checkPasswordLength() {
            const passwordLength = passwordInput.value.length;
            if (passwordLength !== 9) {
                popupMessage.style.display = "block";
                passwordWarning.classList.add("visible");
            } else {
                popupMessage.style.display = "none";
                passwordWarning.textContent = "";
                passwordWarning.classList.remove("visible");
            }
        }
        /* This timer is called a debouncer, it causes the function above to re-check the password length over and over so that it doesn't fire only the once */
        passwordInput.addEventListener("input", () => {
            clearTimeout(timerId);
            timerId = setTimeout(checkPasswordLength, 500);
        });

        /* This script takes the users burger size and qty choices and checks for a discount code then prints out the total at the bottom of the table */
        const sizeOptions = document.getElementById("size");
        const qtyInput = document.getElementById("qty");
        const totalOutput = document.getElementById("total");
        const discountInput = document.getElementById("dCode")
        /* Set up a counter to prevent the alert going off multiple times */
        let alertCount = 0;

        function calculateTotal() {
            /* We get the initial price of the burger */
            let size;
            if (sizeOptions.value === "6oz Large (€7)") {
                size = 7;
            } else if (sizeOptions.value === "10oz Extra-Large (€9)") {
                size = 9;
            } else if (sizeOptions.value === "16oz Supersize (€17.50)") {
                size = 17.50;
            }
            /* This lets the user know their discount worked and sets the discount value to 10% off */
            /* Default discount is 1, due to the structure of the formula this means no discount is applied */
            let discount = 1;
            if (discountInput.value === "extracheese") {
                discount = 0.9;
                /* Checks if the alert count is 0, if it is an alert is displayed and 1 is added to the alert count */
                if (alertCount == 0) {
                    alert("You know the discount code! Please Enjoy 10% Off your Purchase");
                    alertCount += 1;
                }
                
            }
            const qty = parseInt(qtyInput.value) || 0;
            const totalPrice = (size * qty) * (discount);
            totalOutput.textContent = "Total Price: €" + totalPrice.toFixed(2);
        }
        /* Call calculateTotal() when the size, quantity or discount code changes */
        sizeOptions.addEventListener("change", calculateTotal);
        qtyInput.addEventListener("input", calculateTotal);
        discountInput.addEventListener("input", calculateTotal);

        /* Prompt the user for their email, then format the message of the email with a subject line and the total in the body, this is controlled through the URL code */
        function getEmail() {
            var email = prompt("Please enter your email address:");
            if (email != null) {
                var link = "mailto:" + email + "?subject=Your Order&body=" + document.getElementById("total").textContent;
                window.location.href = link;
            }
        }


    </script>

</body>

</html>